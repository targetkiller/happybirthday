<html>
<head>
    <meta charset="utf-8" />
	<title>Happy Birthday!</title>
	<meta name="viewport" content="width=device-width, initial-scale=1,minimum-scale=1, maximum-scale=1, user-scalable=no">
	<meta name="description" content="祝乔帮主生日快乐,寿比南山不老松！" />
	<meta name="apple-mobile-web-app-status-bar-style" content="blank" />
	<link href='http://fonts.googleapis.com/css?family=Oleo+Script+Swash+Caps' rel='stylesheet' type='text/css'>
	<style type="text/css">
	/*修改多说*/
	#ds-thread{
		margin:0px auto;
		padding: 15px;
		background-color: #fff;
	}
	.ds-sync{display:none;}
	/*end 修改多说*/

    html, body{
    	font-size: 62.5%;
		height:100%;
		padding:0;
		margin:0;
		background-color: #ddd;
	}

	
    .main{position: relative;height: 100%;}
   	 @-webkit-keyframes birthday{
			0%{
				 -webkit-transform: scale(0);
			}
			100%{
				 -webkit-transform: scale(1);
			}
		}
	.heart{
		width: 100%;
		background-color: transparent;
		overflow: hidden;
		background-color: #000;
	}
	.photo{
		background-color: #ea80b0;
	}
	.photoItem{
		font-size: 0;
		letter-spacing: -4px;
		width: 100%;
		height: 100%;
		overflow: hidden;
		background: url(bigPic.jpg) center center no-repeat;
		background-size:100%;
	}


	.comment{
		padding: 40px 0 20px 0;
		width: 100%;
		background-color: #ddd;
		text-align: center;
	}
	.groupName{position: absolute;bottom:5px;right: 5px;font-family: helvetica,microsoft yahei;font-size: 1.6rem;color:#fff;text-align: right;margin: 0px 10px 0 0;}

    .wish{
    	font-family: 'Oleo Script Swash Caps', cursive,helvetica,microsoft yahei;
        position: absolute;
        top:50%;
        left: 49%;
        color: #fff;
        width: 255px;
        font-size: 14px;
        text-align: center;
        margin-left: -110px;
        margin-top: -100px;
        -webkit-animation-name:birthday;
        -webkit-animation-duration:2s;
    }
    .wish .name{
    	font-size: 36px;
    	margin:0;
    	margin-top: 10px;
    }
    .wish .txt{
    	margin: 0;
    	margin-top: 10px;
    	font-size: 36px;
    }
	canvas{
		position:absolute;
		width:100%;
		height:100%;
		display: inline-block;
	}
	@-webkit-keyframes tobottom{
			0%{ -webkit-transform:translate(0,0);}
			30%{ -webkit-transform:translate(0,-15px);}
			85%{ -webkit-transform:translate(0,6px);}
			100%{ -webkit-transform:translate(0,0);}
		}
	.toBottom{
		font-family: microsoft yahei;
		line-height: 80px;
		display: block;
		color: #fff;
		opacity: 0.6;
		background-color: #ea80b0;
		border-radius: 45px;
		width: 80px;
		height: 80px;
		margin: 0 auto;
		text-align: center;
		border: 2px solid #ddd;
		position: fixed;
		bottom: 20px;
		left: 48%;
		font-size: 30px;
		cursor: pointer;
		z-index: 9999;
		-webkit-animation:tobottom 2s infinite;
       	}
	.toBottom:hover{
		opacity: 1.0;
	}
	.hidden{display: none;}
    </style>
</head>
<body>

<div class="main">
	<div class="heart hidden">
	    <div class="wish">
	        <p class="name">Jonathan</p>
	        <p class="txt">Happy Birthday!</p>
	    </div>

	    <div class="heartshape">
	    	<canvas id="pinkboard" width="698" height="318"></canvas>
	    </div>
	    <span class="toBottom" onselectstart="return false">↓</span>

	    <div class="groupName">
			<img src="isux.png" />
			<p>社交平台设计中心 前端开发组</p>
		</div>
	</div>

	<div class="photo hidden">
		<div class="photoItem"></div>
	</div>

	<div class="comment hidden">
	<!-- Duoshuo Comment BEGIN -->
		<div class="ds-thread"></div>
		<script type="text/javascript">
		var duoshuoQuery = {short_name:"isux"};
			(function() {
				var ds = document.createElement('script');
				ds.type = 'text/javascript';ds.async = true;
				ds.src = 'http://static.duoshuo.com/embed.js';
				ds.charset = 'UTF-8';
				(document.getElementsByTagName('head')[0] 
				|| document.getElementsByTagName('body')[0]).appendChild(ds);
			})();
		</script>
	</div>
	<!-- Duoshuo Comment END -->
</div>

<script type="text/javascript" src="jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="jquery.mousewheel.js"></script>
<script type="text/javascript">

var $body = $("body");
/*
 * 初始化各面板，让各关键帧自适应填满设备每级显示屏
 */
var windowHeight = document.body.clientHeight;

$(".heart").css("height",windowHeight);
$(".heart").removeClass("hidden");
$(".photo").css("height",windowHeight);
$(".photo").removeClass("hidden");
$(".comment").css("min-height",windowHeight);
$(".comment").removeClass("hidden");

/*
 * 向下滚动
 */
var distance = 0;
var maxHeight = windowHeight*2;//三屏滚动，若向上值大于屏幕高度X2则不再滚动
var minHeight = 0;
var direction = 0;//0为向下，1为向上，滚动方向
var $toBottom = $(".toBottom");
function clickGo(long,flag){
	//向下
	if(direction == 0){
		if(distance<maxHeight){
			distance += long;
			$body.stop().animate({scrollTop: distance+"px"}, 1000);
			if(distance==maxHeight){
				$toBottom.text("↑");
				direction = 1;
			}
		}
		else{
			return false;
		}
	}
	//向上
	else if(direction == 1){
		if(distance>minHeight){
			distance -= long;
			$body.stop().animate({scrollTop: distance+"px"}, 1000);
			if(distance==minHeight){
				$toBottom.text("↓");
			direction = 0;
			}
		}
		else{
			return false;
		}
	}
	
}
function scrollGo(flag,long){
	//鼠标滑向上
	if(flag=="up"){
		if(distance>minHeight){
			distance -= long;
			$body.stop().animate({scrollTop: distance+"px"}, 1000);
			if(distance==minHeight){
				$toBottom.text("↓");
			direction = 0;
			}
		}
		else{
			return false;
		}
	}
	//鼠标滑向下
	if(flag=="down"){
		if(distance<maxHeight){
			distance += long;
			$body.stop().animate({scrollTop: distance+"px"}, 1000);
			if(distance==maxHeight){
				$toBottom.text("↑");
				direction = 1;
			}
		}
		else{
			return false;
		}
	}
}

/*
 * UserAgent判断
 */
/**
 * jQuery.browser.mobile (http://detectmobilebrowser.com/)
 * jQuery.browser.mobile will be true if the browser is a mobile device
 **/
(function(a){jQuery.browser.mobile=/android.+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))})(navigator.userAgent||navigator.vendor||window.opera);

/*先判断UA，若手机端则取消滑动定位*/
if(!jQuery.browser.mobile){
	// alert(navigator.userAgent);
	//按下“向下”按钮时效果
	$toBottom.click(function(){
		clickGo(windowHeight);
	});

	//鼠标滚动时效果
	$body.bind('mousewheel', function(event, delta, deltaX, deltaY) {
	    //console.log(delta, deltaX, deltaY);
	    //detaY = 1;向上
	    //detaY = -1;向下
	    if(deltaY>0){
	    	scrollGo("up",windowHeight);
	    }
	    else{
	    	scrollGo("down",windowHeight);
	    }
	});

}

//图片点击显示祝福语
$lis = $(".photoList").find("li");
$.each($lis,function(key,val){
	$(this).click(function(){
		$(this).hover();
	});
});

var settings = {
	particles: {
		length: 400, // maximum amount of particles
		duration: 2, // particle duration in sec
		velocity: 250, // particle velocity in pixels/sec
		effect: -0.75, // play with this for a nice effect
		size:30, // particle size in pixels
	},
};

/*
 * RequestAnimationFrame polyfill by Erik Möller
 */
(function () {
	var b = 0;
	var c = ["ms", "moz", "webkit", "o"];
	for (var a = 0; a < c.length && !window.requestAnimationFrame; ++a) {
		window.requestAnimationFrame = window[c[a] + "RequestAnimationFrame"];
		window.cancelAnimationFrame = window[c[a] + "CancelAnimationFrame"] || window[c[a] + "CancelRequestAnimationFrame"]
	}
	if (!window.requestAnimationFrame) {
		window.requestAnimationFrame = function (h, e) {
			var d = new Date().getTime();
			var f = Math.max(0, 16 - (d - b));
			var g = window.setTimeout(function () {
				h(d + f)
			}, f);
			b = d + f;
			return g
		}
	}
	if (!window.cancelAnimationFrame) {
		window.cancelAnimationFrame = function (d) {
			clearTimeout(d)
		}
	}
}());

/*
 * Point class
 */
var Point = (function () {
	function Point(x, y) {
		this.x = (typeof x !== 'undefined') ? x : 0;
		this.y = (typeof y !== 'undefined') ? y : 0;
	}

	Point.prototype.clone = function () {
		return new Point(this.x, this.y);
	};
	Point.prototype.length = function (length) {
		if (typeof length == 'undefined')
			return Math.sqrt(this.x * this.x + this.y * this.y);
		this.normalize();
		this.x *= length;
		this.y *= length;
		return this;
	};
	Point.prototype.normalize = function () {
		var length = this.length();
		this.x /= length;
		this.y /= length;
		return this;
	};
	return Point;
})();

/*
 * Particle class
 */
var Particle = (function () {
	function Particle() {
		this.position = new Point();
		this.velocity = new Point();
		this.acceleration = new Point();
		this.age = 0;
	}

	Particle.prototype.initialize = function (x, y, dx, dy) {
		this.position.x = x;
		this.position.y = y;
		this.velocity.x = dx;
		this.velocity.y = dy;
		this.acceleration.x = dx * settings.particles.effect;
		this.acceleration.y = dy * settings.particles.effect;
		this.age = 0;
	};
	Particle.prototype.update = function (deltaTime) {
		this.position.x += this.velocity.x * deltaTime;
		this.position.y += this.velocity.y * deltaTime;
		this.velocity.x += this.acceleration.x * deltaTime;
		this.velocity.y += this.acceleration.y * deltaTime;
		this.age += deltaTime;
	};
	Particle.prototype.draw = function (context, image) {
		function ease(t) {
			return (--t) * t * t + 1;
		}

		var size = image.width * ease(this.age / settings.particles.duration);
		context.globalAlpha = 1 - this.age / settings.particles.duration;
		context.drawImage(image, this.position.x - size / 2, this.position.y - size / 2, size, size);
	};
	return Particle;
})();

/*
 * ParticlePool class
 */
var ParticlePool = (function () {
	var particles,
			firstActive = 0,
			firstFree = 0,
			duration = settings.particles.duration;

	function ParticlePool(length) {
		// create and populate particle pool
		particles = new Array(length);
		for (var i = 0; i < particles.length; i++)
			particles[i] = new Particle();
	}

	ParticlePool.prototype.add = function (x, y, dx, dy) {
		particles[firstFree].initialize(x, y, dx, dy);

		// handle circular queue
		firstFree++;
		if (firstFree == particles.length) firstFree = 0;
		if (firstActive == firstFree) firstActive++;
		if (firstActive == particles.length) firstActive = 0;
	};
	ParticlePool.prototype.update = function (deltaTime) {
		var i;

		// update active particles
		if (firstActive < firstFree) {
			for (i = firstActive; i < firstFree; i++)
				particles[i].update(deltaTime);
		}
		if (firstFree < firstActive) {
			for (i = firstActive; i < particles.length; i++)
				particles[i].update(deltaTime);
			for (i = 0; i < firstFree; i++)
				particles[i].update(deltaTime);
		}

		// remove inactive particles
		while (particles[firstActive].age >= duration && firstActive != firstFree) {
			firstActive++;
			if (firstActive == particles.length) firstActive = 0;
		}


	};
	ParticlePool.prototype.draw = function (context, image) {
		// draw active particles
		if (firstActive < firstFree) {
			for (i = firstActive; i < firstFree; i++)
				particles[i].draw(context, image);
		}
		if (firstFree < firstActive) {
			for (i = firstActive; i < particles.length; i++)
				particles[i].draw(context, image);
			for (i = 0; i < firstFree; i++)
				particles[i].draw(context, image);
		}
	};
	return ParticlePool;
})();

/*
 * Putting it all together
 */
(function (canvas) {
	var context = canvas.getContext('2d'),
			particles = new ParticlePool(settings.particles.length),
			particleRate = settings.particles.length / settings.particles.duration, // particles/sec
			time;

	// get point on heart with -PI <= t <= PI
	function pointOnHeart(t) {
		return new Point(
				160 * Math.pow(Math.sin(t), 3),
				130 * Math.cos(t) - 50 * Math.cos(2 * t) - 20 * Math.cos(3 * t) - 10 * Math.cos(4 * t) + 25
		);
	}

	// creating the particle image using a dummy canvas
	var image = (function () {
		var canvas = document.createElement('canvas'),
				context = canvas.getContext('2d');
		canvas.width = settings.particles.size;
		canvas.height = settings.particles.size;
		// helper function to create the path
		function to(t) {
			var point = pointOnHeart(t);
			point.x = settings.particles.size / 2 + point.x * settings.particles.size / 350;
			point.y = settings.particles.size / 2 - point.y * settings.particles.size / 350;
			return point;
		}

		// create the path
		context.beginPath();
		var t = -Math.PI;
		var point = to(t);
		context.moveTo(point.x, point.y);
		while (t < Math.PI) {
			t += 0.01; // baby steps!
			point = to(t);
			context.lineTo(point.x, point.y);
		}
		context.closePath();
		// create the fill
		context.fillStyle = '#ea80b0';
		context.fill();
		// create the image
		var image = new Image();
		image.src = canvas.toDataURL();
		return image;
	})();

	// render that thing!
	function render() {
		// next animation frame
		requestAnimationFrame(render);

		// update time
		var newTime = new Date().getTime() / 1000,
				deltaTime = newTime - (time || newTime);
		time = newTime;

		// clear canvas
		context.clearRect(0, 0, canvas.width, canvas.height);

		// create new particles
		var amount = particleRate * deltaTime;
		for (var i = 0; i < amount; i++) {
			var pos = pointOnHeart(Math.PI - 2 * Math.PI * Math.random());
			var dir = pos.clone().length(settings.particles.velocity);
			particles.add(canvas.width / 2 + pos.x, canvas.height / 2 - pos.y, dir.x, -dir.y);
		}

		// update and draw particles
		particles.update(deltaTime);
		particles.draw(context, image);
	}

	// handle (re-)sizing of the canvas
	function onResize() {
		canvas.width = canvas.clientWidth;
		canvas.height = canvas.clientHeight;
	}

	window.onresize = onResize;
	// delay rendering bootstrap
	setTimeout(function () {
		onResize();
		render();
	}, 10);
})(document.getElementById('pinkboard'));

	window.onload = function(){
		$body.stop().animate({scrollTop: 0}, 1000);
		onResize();
		render();
	};

	onResize();
	render();
</script>
<script type="text/javascript" src="http://tajs.qq.com/stats?sId=27557871" charset="UTF-8"></script>
</body>
</html>